<html>
<head>
  <title>Nginx重写---木泉课程 2020-8-18 10:42:35 192.168.0.133 34:10</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602326 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2881"/>
<h1>Nginx重写---木泉课程 2020-8-18 10:42:35 192.168.0.133 34:10</h1>

<div>
<span><div><div>Nginx重写---木泉课程<span>    </span><span>    </span>  2020-8-18 10:42:35          192.168.0.133              34:10</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><b><font color="#FF0000">#这堆是动静分离</font></b></div><div>worker_processes  1;</div><div>events {</div><div>    worker_connections  1024;</div><div>}</div><div>http {</div><div>    include    mime.types;</div><div>    default_type    application/octet-stream;</div><div>    sendfile    on;</div><div>    keepalive_timeout    65;</div><div>    server {</div><div>        listen 80;</div><div>        server_name     bbs.thinkmo.com;</div><div>        location / {</div><div>            root html;</div><div>            index   index.html   index.htm;</div><div>            proxy_set_header  Host  $host;</div><div>            proxy_pass  http://web_discuz;</div><div>        }</div><div>        <b><font color="#FF0000">location ~*  .*\.(html|htm|css|js|png|jpg|jpeg)$</font></b></div><div>        {</div><div>            root   /var/www/html/discuz;</div><div>        }</div><div>        <b><font color="#FF0000">location  ~* .*\.(asp|jsp|do)$</font></b></div><div>        {</div><div>            proxy_set_header    Host  $host;</div><div>            proxy_pass   http://web_discuz;   #动态的请求反向代理到后端去处理</div><div>        }</div><div>    }</div></div><div><br/></div><ul><li><div>规则重写，上网、服务器 ，web 负载均衡侧重对于访问的流量（PV）进行优化。要让nginx性能提升，承载更多访问并发。</div></li><li><div>对于访问跳转（体验）的优化。假如我们在 url后面加路径会跳转到一些地方来</div></li></ul><div><span style="font-weight: bold;"><img src="Nginx重写---木泉课程 2020-8-18 104235 192.168.0.133_files/Image.png" type="image/png" data-filename="Image.png"/></span></div><ul><li><div><span style="font-weight: bold;">这种叫不友好的访问，我们需要让他跳转到我的</span><span style="font-weight: bold; text-decoration: underline;">主页</span><span style="font-weight: bold;">上。总之不要搞成404就好</span></div></li><li><div>还有一个，我拿手机打开网站和拿电脑打开网站一样吗？是不一样的，他跳转的页面是完全不同的。如果手机端访问PC版，一看会非常的丑。这个时候就可以进行重写的规则让你跳转。</div></li><li><div>涉及到正则表达式，基于Perl语言。基本上，所有web服务器均可支持URL重写。</div></li><li><div>搜索引擎对静态的收录远远比动态的强。</div></li></ul><div><br/></div><ul><li><div>另外，每次访问的时候后面跟个index.html不好看   <a href="http://www.thinkmo.com.cn/index.html">www.thinkmo.com.cn/index.html</a> 。我要把他隐藏，<span style="font-weight: bold;">也就是说要当我敲index.html的时候我会自动跳转到   </span><a href="http://www.thinkmo.com.cn/" style="font-weight: bold;">www.thinkmo.com.cn</a></div></li><li><div>网站优化升级。经常看到“网页建设中”，可以基于 Rewrite 临时重定向到其他页面。</div></li><li><div>随便down一个网页</div></li></ul><div><a href="Nginx重写---木泉课程 2020-8-18 104235 192.168.0.133_files/index.html"><img src="Nginx重写---木泉课程 2020-8-18 104235 192.168.0.133_files/4d19701ddc536a121f39da38c003d983.png" alt="index.html"></a></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>wget  -r -x     #表示抓取你网站的源代码</div><div>mv index.html  build.html</div></div><div><br/></div><ul><li><div>Nginx  Rewrite 结尾标识符，用于 Rewrite 规则末尾，表示规则的执行属性</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>last:   相当于apache里面的L标记，表示完成rewrite匹配</div><div>break:  本条规则匹配完成后，终止匹配，不再匹配后面的规则。跳出循环</div><div>redirect:  返回302临时重定向，浏览器地址会显示跳转后的URL地址  --在安装discuz和wordpress都是302，你装完之后你就不跳了</div><div>permanent:  返回301永久重定向，浏览器地址栏会显示跳转后的URL地址</div><div> </div><div>其中 last和break用来实现URL重写时，浏览器地址栏的URL地址不变。比如：</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">blog.thinkmo.com/slkdfjlskdjf   时输入完之后地址还是不变的    </span>blog.thinkmo.com/slkdfjlskdjf</div></div><ul><li><div>Nginx  Rewrite 常用规则表达式，主要用于匹配参数，字符串及过滤设置</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>.    匹配任何单字符</div><div>[word]    匹配字符串：word</div><div>[^word]    不匹配字符串：word</div><div>thinkmoedu|thinkmoteach    可选择的字符串</div><div>?    匹配0到1个字符</div><div>*    匹配0到多个字符</div><div>+    匹配1到多个字符</div><div>^    字符串开始标志</div><div>$    字符串结束标志</div><div>\n    转义符标志</div></div><div><br/></div><ul><li><div>Nginx  Rewrite 变量 ，用于匹配信息的请求头，浏览器主机名、URL等</div></li></ul><div><img src="Nginx重写---木泉课程 2020-8-18 104235 192.168.0.133_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>假如我访问的是 .exe ，那么我就不展示，直接下载了。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>HTTP headers: HTTP_USER_AGENT, HTTP_REFERER,  HTTP_COOKIE , HTTP_POST , HTTP_ACCEPT;</div><div>connection &amp; request:  REMOTE_ADDR , QUERY_STRING;</div><div>server internals:  DUCUMENT_ROOT, SERVER_PORT, SERVER_PROTOCOL;</div><div>system stuff:  TIME_YEAR,  TIME_MON,  TIME_DAY</div><div>HTTP_USER_AGENT    用户客户端，你是哪个浏览器（IE，Chrome  &amp;  360 &lt;---这俩都是谷歌内核，所以访问的时候是一个情况），底层系统（苹果，Iphone几，windows，linux）</div></div><div><img src="Nginx重写---木泉课程 2020-8-18 104235 192.168.0.133_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>HTTP_REFERE    告知服务器，从哪个页面来访问的。有的公司会投付费的广告,那怎么落地到放服务器？他有一个路径。论坛还是贴吧</div><div>HTTP_COOKIE    客户端缓存你，主要用于存储用户名和密码</div><div>HTTP_HOST    匹配服务器ServerName 域名</div><div>HTTP_CCEPTS    客户端浏览器支持的MIME类型，实际上就是各种文件的类型。比方说 .html给你展示，.exe下载</div><div>REMOTE_ADDR       客户端的IP地址</div><div>QUERY_STRING  URL中访问的字符串</div><div>DOCUMENT_ROOT       服务器发布目录</div><div>SERVER_PORT    服务器端口</div><div>SERVER_PROTOCOL    服务器协议</div><div>TIME_YEAR    年</div><div>TIME_MON    月</div><div>TIME_DAY    日        </div></div><div><br/></div><ul><li><div>生产环境的nginx像下面那样写：</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server_name  mqzzl.fun  www.mqzzl.fun  (.*).mzzl.fun;</div></div><ul><li><div>比方说我访问  www.mqzzl.fun的时候又访问到  mqzzl.fun ，访问其他的时候，又访问到  mqzzl.fun 。那么我就会认为你另外那两个域名是抄 mqzzl.fun 这个的。所以你后边那两个网址压根不会被收录，或及其靠后。</div></li><li><div>这个时候你要做的是集权，集中你的权重。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>server_name  mqzzl.fun  www.mqzzl.fun;</div><div>if ($host = 'mqzzl.fun' ) {</div><div>    rewrite  ^/$  http://www.mqzzl.fun/   permanent;   #当你输入了域名，我发现了是mqzzl.fun的时候，我会把你跳转到 http://www.mqzzl.cun这个域名上并且是以 / 结尾的。 同时是以 permanent 永久有效，永久解析过去</div><div>}</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">mkdir  -p  /usr/local/nginx/html/linux  #路径URL</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">ll   &amp;&amp;   nginx -t     #检查</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">nginx  -s reload    #重启</span></div></div><ul><li><div>浏览器访问  mqzzl.fun/linux</div></li></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 