<html>
<head>
  <title>第十二课 iptabels+firewalld 2020-8-12 14:30:30</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602326 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2773"/>
<h1>第十二课 iptabels+firewalld 2020-8-12 14:30:30</h1>

<div>
<span><div><div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">第十二课  iptabels+firewalld</span></font>    2020-8-12 14:30:30</div><hr/><div><span style="font-size: 16pt; color: rgb(65, 173, 28); font-weight: bold;">iptables的下半部分</span></div><ul><li><div>在7系统实际上是5表5链。常用的是 <span style="text-decoration: underline;">filter</span> , <span style="text-decoration: underline;">nat</span> , <span style="text-decoration: underline;">mangle</span> , <span style="text-decoration: underline;">raw</span> , <span style="text-decoration: underline;">security</span> . </div></li><li><div>常用的链有 PREROUTING ，INPUT，FOWARD，OUTPUT，POSTROUTING。</div></li><li><div>表示小写，链是大写。在链里面会有具体的规则。而规则才是重点。</div></li></ul><ol><li><div>-A ， 表示在末尾插入，追加</div></li><li><div>-I，   可以在后面跟 数字，表示在第几行插入</div></li><li><div>-D，  加数字表示删除第几行</div></li><li><div>-F，   临时清空iptables</div></li><li><div>-Z，   清除计数器，如果我想看的更仔细就清零数据包的传输数据</div></li><li><div>-n，用数字表示端口</div></li><li><div>--line-number    ，显示规则的id，方便删除</div></li><li><div>-i,-o,-s,-d,--dports,--sports</div></li></ol><ul><li><div>防火墙起作用的是他的内核，iptables只是一个工具而已。内核叫做<span style="color: rgb(255, 0, 0); font-weight: bold;">netfilter</span>。</div></li><li><div>iptables但凡回车，立即生效。在防火墙策略之前一定要深思熟虑。</div></li></ul><div><br/></div><div><span style="font-size: 14pt; color: rgb(54, 101, 238); font-weight: bold;">通过软防保护服务器</span></div><ul><li><div>web服务器，需要放行一些常见的端口：80，443,8080,8443 。如果公司还有dns，我们还要放行53 。如果是用的nginx，那么还要加上 php-fpm的 9000端口</div></li><li><div>软防是允许单服务器的防护</div></li><li><div>弄清我们对外服务的对象，我允许哪些端口是目的地址</div></li><li><div>写规则的时候要注意顺序，最终的目的是要<span style="color: rgb(255, 0, 0); font-weight: bold;">默认拒绝</span>。<span style="color: rgb(227, 0, 0); text-decoration: underline;">但之前一定要把22放行</span>。</div></li><li><div>网络接口 lo 的一般都是做测试，要放行</div></li><li><div>状态监测的处理。--state ，当你接手新机器，那么有很多未知的端口，此时我们要使用state。也就是说我们使用tcp建立的，和用tcp传输数据建立的新的连接，都把他放行。</div></li><li><div>如果你想要保存，用iptables save就行了。保证重启的时候，他读取的还是你的配置文件。</div></li></ul><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image.png" type="image/png" data-filename="Image.png"/></div><ul><li><div>一般我们在硬件防火墙和路由器之间还会插入一个设备，叫做IPS。叫做入侵保护系统，二他有两种接入方式，一种是串接，第二种是旁接。</div></li><li><div>IDS这是入侵检测系统，一般放在数据库或者重点的服务器前。做异常流量检测，超出常规动作之外的就叫异常流量。他们不会过滤，他们只是做报告。</div></li><li><div>很多公司在防火墙内部还会加上一个跳板机。</div></li></ul><div><br/></div><div><span style="font-size: 14pt; color: rgb(54, 101, 238); font-weight: bold;">iptables-server  192.168.0.177  ；   iptables-cli  192.168.0.178</span></div><div><br/></div><ul><li><div>iptables-server 这边还是web服务器，178这边是客户端</div></li><li><div>先把默认策略清空，<span style="color: rgb(255, 0, 0); font-weight: bold;">清空前看清楚policy是accept还是drop</span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[ser]#  <b>iptables -F</b></div></div><ul><li><div>第一步，我要把我的环回放行。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">[ser]#  <b>iptables -P INPUT  ACCEPT</b></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">[ser]#  <b>iptables -F</b></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">[ser]#  <b>iptables -A  INPUT  -i  lo  -j  ACCEPT</b>          #这时候我要放行 -t，不放行的话就是制定filter表。INPUT链，那么我们的数据肯定是经过 PREROUTING，INPUT, FORWARD,OUTPUT,POSTROUTING这个顺序的。后面环回lo也可以写成 -s 127.0.0.0/24</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">[ser]#  <b>iptables  -A  INPUT  -p  tcp  -m  multiport  --dports  22,80,8080,443,8443  -j  ACCEPT </b>      #加上multiport可以加多个端口，不加的话就用冒号，但是用multiport的话我可以选择开放哪些，不开放哪些</span></div></div><ul><li><div>那么之前说过，如果有端口，那么必须有协议。</div></li><li><div>允许已经建立tcp连接的包及该连接相关的包通过。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; font-family: Monaco;">[ser]#  <b>iptables -A  INPUT  -m  state  --state  <font color="#41AD1C">NEW,</font>RELATED,ESTABLISHED  -j  ACCEPT</b>   #如果你的机器很稳定的话，我为什么不加new？如果我记上new的话，我是不是所有的tcp都会放行。</span></div></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><ul><li><div>最后再把我们的默认改成DROP</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[ser]#  iptables -P  INPUT  DROP   #默认是唯一不用 -j 参数的</div></div><ul><li><div>一般OUTPUT是不受限制的，服务器可以主动往外进行连接。</div></li><li><div>同时装服务</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[ser]# yum -y install httpd</div><div>[ser]# vim /etc/httpd/conf/httpd.conf</div><div>---------------------------</div><div>ServerName 127.0.0.1</div></div><div><br/></div><ul><li><div>此时看一下我们其他的设备能否访问到</div></li></ul><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><ul><li><div>现在是正常访问的</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[cli]#  yum -y install elinks</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[ser]#  echo &quot;server&quot; &gt; /var/www/html/index.html</div><div>[ser]#  systemctl restart httpd</div></div><div><br/></div><hr/><div>使用SNAT</div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>SNAT的功能就是类似家用路由器去共享上网，使用内网的pc机通过nat的共享，就可以上网。</div></li></ul><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ping 192.168.1.1  #这个是我们家里的网关</div><div>#那现在呢我要给添加一个网卡，让我们的slave上面也有一个网段。</div><div>#最终将我们的master作为一个跳板，或者说是路由器，进行转换。</div></div><ul><li><div>但凡是涉及到snat或者dnat，我们一定是用的nat表。需求是slave通过master可以上网。</div></li><li><div>在配置上master需要有两张网卡</div></li></ul><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><ul><li><div>然后要编辑虚拟机网络选项。进去找到NAT8网络。取消勾选dhcp，因为会冲突的。</div></li></ul><div><br/></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[ser]# ifconfig   #看看是不是有两个网卡</div></div><div><br/></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><ul><li><div>此时我让他<span style="font-weight: bold;">临时生效，重启失效</span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[ser]# ifconfig ens37  192.168.2.1/24 up</div></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><ul><li><div>如果让他临时启动时 ifup </div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[ser]#  ifup  ens34</div><div>[ser]#  ifdown ens34</div></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>自己一些报错，网上查找的解决方法</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>yum -y install initscripts</div><div>chkconfig network off</div><div>chkconfig network on</div><div>service NetworkManager stop</div><div>service NetworkManager start</div></div><div><br/></div><ul><li><div>此时操作ens37新网卡会报错</div></li></ul><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>这时候你需要自己写网卡文件</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[ser]#  cp -a ifcfg-ens33  ifcfg-ens37</div><div>[ser]#  vim  ifcfg-ens37    #把内容改掉</div><div>--------------</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">TYPE=Ethernet</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">BOOTPROTO=static</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">DEFROUTE=yes</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">NAME=ens37</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">DEVICE=ens37</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">ONBOOT=yes</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">IPTADDR=192.168.2.1     #让他作为内部网关</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">NETMASK=255.255.255.0</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">GATEWAY=192.168.0.1</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">[ser]#  ifdown ens37   #这时候不报错了</span></div></div><div><br/></div><div><br/></div></div><hr/><div>Firewalld        2020-12-5 00:39:43</div><ul><li><div>firewalld 叫动态防火墙。iptables一旦回车立刻生效，但是firewalld回车不会立刻生效，必须通过 --reload重置。同时 iptables 但凡是进行生效是所有生效，而 --reload 是可以选择某个一条规则生效，控制比较灵活。</div></li><li><div>firewalld两个部分组成，一个是 service ，一个是daemon。但是他本身有 cli 、gui 都可以去配置，仅仅代替了 service 部分。而最核心的还是叫做 netfilter 在内核上。</div></li><li><div>在这里面有一个<span style="text-decoration: underline;">区域</span>概念，便于我们做<span style="text-decoration: underline;">切换</span>的。iptables会有专用网、共用网、家用网。iptables每一次都要清空重启，而firewalld是通过zone切换可以达到效果</div></li><li><div>zone里面有几个是已经默认存在了的。一个<span style="text-decoration: underline;">zone就是一套过滤规则</span>，默认的有<span style="text-decoration: underline;">九个</span>：block , dmz（硬防有--映射） , drop external, home , internal , public , trusted , work 。 centos 7 默认把firewalld设置为 public 。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">systemctl  start  firewalld</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">firewall-cmd  --get-zones       #区别在于放行的端口不同，数据包不同</span></div></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [14].png" type="image/png" data-filename="Image.png" width="571"/></div><ul><li><div>第一个叫做drop 丢弃，任何接收的网络数据包都被丢弃，没有任何回复，仅能有发送出去的网络连接。---这个还没有安全模式</div></li><li><div>第二个叫做block 限制，任何接收的网络连接都被IPv4的 icmp host-prohibited 信息和 IPv6 的 icmp6-adm-prohibited 信息所拒绝</div></li><li><div>public 公共，在公共区域使用，不能相信网络内的其他计算机不会对您的计算机造成危害，只能接收经过选取的连接。</div></li><li><div>external 外部，特别是为路由器启用了伪装功能的外部网。您不能信任来自网络的其他计算，不能相信他们不会对您的计算机造成危害，只能接收经过选择的连接</div></li><li><div>dmz 非军事区，用于您的非军事区的电脑，此区域内可公开访问，可以有限地进入您的内部网络，仅仅接收经过选择的连接</div></li><li><div>work ，用于工作区，您可以基本相信网络内的其他电脑不会危害您的电脑，仅仅接收经过选择的连接。</div></li><li><div>home 家庭，用于家庭网络，你可以基本信任王立国内的其他计算机不会危害你的计算机，仅仅接受经过的选择</div></li><li><div>trusted 信任，可接受所有的网络连接，</div></li></ul><div><br/></div><ul><li><div>我们制定其中一个区域为默认区域是可行的，当借口加入了NetworkManager，他就会分配为默认区域，安装时firewalld里的默认区域被设定为公共区域</div></li><li><div>简单来说就是用户预先准备了几套规则集合，根据不同场景用。</div></li><li><div>firewalld也算是一个服务软件工具，在 /usr/lib/firewalld/services/ 目录中，还保存了另外一类配置文件，每个文件对应一项具体的网络服务比方说ssh 。</div></li></ul><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [15].png" type="image/png" data-filename="Image.png" width="580"/></div><ul><li><div>firewalld一定是比iptabels高级的，iptables做不了的他也能做。iptables因为他是纯命令行，他的书写上会更加简单一些，不管是命令还是参数上都是有规矩去寻找的。firewalld因为有图形去支持，所以他去配置的时候是很麻烦的。</div></li><li><div>xml类型格式</div></li></ul><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [16].png" type="image/png" data-filename="Image.png" width="569"/></div><ul><li><div>当我们需要自定义某项服务的端口时，我们需要将service配置文件放在 /etc/firewalld/services 目录中</div></li><li><div>比如ssh服务默认运行在 22 端口 ，如果你的ssh服务运行在 220 端口，需要放行 220 ，需要把 /usr/lib/firewalld/ssh.xml  文件拷贝到 /etc/firewalld/services/ 目录下，修改文件端口为220</div></li><li><div>service配置的好处，可以通过服务名字来管理规则更加人性化，通过服务来组织端口分组模式更加高效，如果一个服务使用若干个网络端口，则服务的配置文件就相当于配置了这些端口的规则管理批量操作快捷方式。</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>yum -y install bash-completion</div><div>firewall-cmd --get-serviecs     #列出所有支持的 service，和加载是两码事</div></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [17].png" type="image/png" data-filename="Image.png" width="535"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd  --list-services         #列出加载的模块</div></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [18].png" type="image/png" data-filename="Image.png" width="578"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd  --state    #显示状态</div><div>firewall-cmd  --get-active-zones    #查看区域信息</div><div>firewall-cmd  <font color="#FF0000">--get-zone-of-interface=eth0</font><font color="#FF0000"> </font>   #查看指定接口所属区域，<font color="#FF0000">划定端口属于哪个区域</font></div><div>firewall-cmd  --panic-on   #拒绝所有包  断网   类似于windows的单机</div><div>firewall-cmd  --panic-off    #取消拒绝状态   联网  </div><div>firewall-cmd  --query-panic    #查看是否拒绝</div></div><ul><li><div>更新防火墙规则</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd  --reload    #立刻生效</div></div><ul><li><div>设置默认接口区域</div></li><ul><li><div>firewalld 和 iptabels 都是一样的，只是临时有效</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd  --set-default-zone=public     #立即生效，区域是无需重启的</div><div># 加上 --permanent 永久生效，必须reload防火墙，否则你得下一次重启才能生效</div></div><ul><li><div>打开端口</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd  --zone=dmz  --list-ports   #查看所有打开的端口</div><div>firewall-cmd  --zone=dmz  --add-port=8080/tcp    #加入一个端口到区域</div></div><ul><li><div>打开一个服务类似于把端口可视化，服务需要在配置文件中进行添加（services目录）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd  --zone=work  --add-service=smtp</div><div>firewall-cmd  --zone=work  --remove-service=smtp</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd  --list-all</div></div><div><img src="第十二课 iptabels+firewalld 2020-8-12 143030_files/Image [19].png" type="image/png" data-filename="Image.png" width="580"/></div><ul><li><div>修改接口所属区域</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd [--zone=&lt;zone&gt;] --change-interface=&lt;interface&gt;</div></div><ul><li><div>开放80端口提供外网访问http服务，将 http.xml 复制到 /etc/firewalld/services/ 下面，以服务形式管理防火墙</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>cp  <b><font color="#FF0000">-a </font></b> /usr/lib/firewalld/services/http.xml  /etc/firewalld/services/</div><div>cd  /etc/firewalld/services/</div><div>cp http.xml  http.xml.bak</div></div><ul><li><div>修改 public.xml ，加入http服务，如果有多个service就分开写</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim /etc/firewalld/zones/public.xml</div><div>--------------------------------------</div><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div>&lt;zone&gt;</div><div>&lt;short&gt;Public&lt;/short&gt;</div><div>&lt;description&gt;For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected icoming connections are accepted. &lt;/description&gt;</div><div>&lt;service name=&quot;dhcpv6-client&quot;/&gt;</div><div>&lt;service name=&quot;ssh&quot;/&gt;</div><div>&lt;service name=&quot;http&quot;/&gt;</div><div>&lt;/zone&gt;</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd  --reload</div><div>firewall-cmd  --list-all</div></div><ul><li><div>貌似没有生效。用命令试一下</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd --permanent --add-service=http</div></div><div><br/></div><ul><li><div>修改防火墙ssh的端口方法</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>cp  -a  /usr/lib/firewalld/services/ssh.xml  /etc/firewalld/services/</div><div>vim  /etc/firewalld/services/ssh.xml</div><div>---------------------------------------------</div><div>&lt;?xml version=&quot;1.0&quot;  encoding=&quot;utf-8&quot;?&gt;</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;service&gt;</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;short&gt;SSH&lt;/short&gt;</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;description&gt; ......  &lt;/description&gt;</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;port protocol=&quot;tcp&quot; port=&quot;12222&quot; /&gt;</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;/service&gt;</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd --reload</div></div><div><br/></div><ul><li><div>指定ip访问ssh端口</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim  /etc/firewalld/zones/public.xml</div><div>-----------------------------------</div><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div>&lt;zone&gt;</div><div>&lt;short&gt;Public&lt;/short&gt;</div><div>&lt;description&gt;...&lt;/description&gt;</div><div>&lt;service name=&quot;dhcpv6-client&quot;/&gt;</div><div>&lt;rule family=&quot;ipv4&quot;&gt;</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;source address=&quot;192.168.23.1&quot;/&gt;</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;service name=&quot;ssh&quot;/&gt;</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;accept/&gt;</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;/rule&gt;</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;/zone&gt;</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>firewall-cmd --reload</div></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 