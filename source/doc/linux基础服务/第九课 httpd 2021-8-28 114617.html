<html>
<head>
  <title>第九课 httpd 2021-8-28 11:46:17</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602326 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="8823"/>
<h1>第九课 httpd 2021-8-28 11:46:17</h1>

<div>
<span><div><div><div>第九课  httpd        2021-8-28 11:46:17</div><hr/><ul><li><div>虚拟主机：基于ip，基于端口，基于域名。权限控制：默认目录缺少主页会直接显示列表，公网上要限制；个人主页类似于虚拟主机。 http+ssl 变成https</div></li><li><div>web服务器常见的apache，nginx，iis（付费），tomcat，tengine。</div></li><li><div>asp/jsp/php 与数据库有交互，动态解析。动态网页不容易被搜索引擎收录。伪静态（伪装静态便于收录）。</div></li><li><div>apache稳定，臃肿，代码模块多。</div></li><li><div>iis不只包含http，还包含 ftp  nmtp  smtp等服务</div></li><li><div>http支持很多api的接口</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>yum -y install httpd  httpd-devel    #默认装的 2.4版本</div></div><ul><li><div>httpd.conf 注释行信息、全局配置、区域配置</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ServerRoot    服务目录/etc/httpd 一般不改</div><div>ServerAdmin    管理员邮箱</div><div>User    运行服务用户</div><div>Group    组</div><div>ServerName    网站域名 www.example.com改为127.0.0.1</div><div>DocumentRoot    网站目录</div><div>Listen    监听的ip端口</div><div>DirectoryIndex    首页</div><div>ErrorLog    错误日志</div><div>CustomLog    访问日志</div><div>Timeout    网站超时时间，默认300秒</div></div></div><ul><li><div>如果取消首页欢迎页面，此时就会暴露你的目录结构</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>cd /etc/httpd/conf.d</div><div>mv  welcome.conf  welcome.conf.bak</div><div>systemctl restart httpd</div></div><div><img src="第九课 httpd 2021-8-28 114617_files/Image.png" type="image/png" data-filename="Image.png"/></div><ul><li><div>修改默认主页</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim /etc/httpd/conf/httpd.conf</div><div>--------------------</div><div>DocumentRoot  &quot;/<font color="#FF0000">home/wwwroot</font>&quot;   </div><div>#&lt;Directory &quot;/var/www&quot;&gt;        注释掉与/var/www相关的配置</div><div>#    AllowOverride None</div><div>#    # Allow open access:</div><div>#    Require all granted</div><div>#&lt;/Directory&gt;</div><div><br/></div><div>&lt;Directory &quot;/home/wwwroot&quot;&gt;</div></div><ul><ul><li><div>Options Indexes是允许查看目录，Require all granted是允许所有人访问。</div></li><li><div>现在重启服务</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mkdir -p  /home/wwwroot</div><div>systemctl restart httpd</div><div>echo &quot;Welcome&quot; &gt; /home/wwwroot/index.html</div></div><div><br/></div><ul><li><div>个人主页，在系统中为每个用户创建一个网站。不想占用域名、ip、端口，在/etc/httpd/conf.d下有一个userdir.conf用户目录，默认是disabled禁用你的</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim /etc/httpd/conf.d/userdir.conf</div><div>-----------------------------------</div><div># UserDir disabled  注释掉</div><div>UserDir public_html</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>useradd thinkmo</div><div>useradd linux</div><div>su - thinkmo  # 在/home/thinkmo下</div><div>mkdir public_html</div><div>echo &quot;ThinkMo&quot; &gt; public_html/index.html</div><div>chmod -Rf 755 /home/thinkmo</div><div>su - linux </div><div>mkdir public_html</div><div>echo &quot;linux&quot; &gt; public_html/index.html</div><div>chmod -Rf 755 /home/linux</div><div><br/></div><div>systemctl restart httpd</div></div><ul><li><div>访问方式</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>http://192.168.0.101/~thinkmo</div></div><div><img src="第九课 httpd 2021-8-28 114617_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>http://192.168.0.101/~linux</div></div><div><img src="第九课 httpd 2021-8-28 114617_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>这样暴露家目录会不安全，所以需要加密。htpasswd</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>htpasswd -c /etc/httpd/passwd thinkmo</div><div>htpasswd /etc/passwd linux</div></div><ul><li><div>修改个人目录</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim  /etc/httpd/conf.d/userdir.conf</div><div>-------------------------------</div><div>&lt;Directory &quot;/home/*/public_html&quot;&gt;</div><div>    AllowOverride all</div><div>#    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec</div><div>    Require user thinkmo</div><div>    Require user linux</div><div>    authuserfile &quot;/etc/httpd/passwd&quot;</div><div>    authname &quot;My private website&quot;</div><div>    authtype basic</div><div>&lt;/Directory&gt;</div></div><ul><li><div>重启</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>systemctl restart httpd</div></div><div><br/></div><ul><li><div>虚拟主机。</div></li><ul><li><div>ip虚拟主机    增加两块网卡</div></li></ul></ul><div><img src="第九课 httpd 2021-8-28 114617_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><ul><ul><li><div>复制网卡配置文件</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>cp -a ifcfg-ens33  ifcfg-ens38</div><div>cp -a ifcfg-ens33  ifcfg-ens39</div><div>vim ifcfg-ens38</div><div>-----------------------</div><div>NAME=&quot;ens38&quot;</div><div>DEVICE=&quot;ens38&quot;</div><div>#UUID=&quot;d9d170b9-c5fc-4083-8224-f36aedcf902e&quot;</div><div><br/></div><div><br/></div><div>vim ifcfg-ens39</div><div>-----------------------</div><div>NAME=&quot;ens39&quot;</div><div>DEVICE=&quot;ens39&quot;</div><div>#UUID=&quot;d9d170b9-c5fc-4083-8224-f36aedcf902e&quot;</div></div><ul><ul><li><div>找到配置文件 追加VirtualHost</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim /etc/httpd/conf/httpd.conf</div><div>------------------------------------</div><div>&lt;VirtualHost 192.168.0.101:80&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/www&quot;</div><div>    ServerName  www.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/www&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost 192.168.0.104:80&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/bbs&quot;</div><div>    ServerName  bbs.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/bbs&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost 192.168.0.105:80&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/blog&quot;</div><div>    ServerName  blog.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/blog&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div></div><ul><li><div>创建目录</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mkdir -p /home/wwwroot/{www,bbs,blog}</div><div>echo 'bbs' &gt; /home/wwwroot/bbs/index.html</div><div>echo 'blog' &gt; /home/wwwroot/blog/index.html</div></div><div><img src="第九课 httpd 2021-8-28 114617_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><img src="第九课 httpd 2021-8-28 114617_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>基于主机域名的</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim /etc/hosts</div><div>---------------</div><div>192.168.0.101 www.thinkmo.com   bbs.thinkmo.com blog.thinkmo.com</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim /etc/httpd/conf/httpd.conf</div><div>------------------------------------</div><div>&lt;VirtualHost 192.168.0.101:80&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/www&quot;</div><div>    ServerName  www.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/www&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost 192.168.0.101:80&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/bbs&quot;</div><div>    ServerName  bbs.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/bbs&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost 192.168.0.101:80&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/blog&quot;</div><div>    ServerName  blog.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/blog&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div></div><div><br/></div><div><br/></div><ul><li><div>基于端口</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim /etc/httpd/conf/httpd.conf</div><div>------------------------------------</div><div>Listen 80</div><div>Listen 8080</div><div>Listen 8088</div><div><br/></div><div>&lt;VirtualHost 192.168.0.101:80&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/www&quot;</div><div>    ServerName  www.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/www&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost 192.168.0.101:8080&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/bbs&quot;</div><div>    ServerName  bbs.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/bbs&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost 192.168.0.101:8088&gt;</div><div>    DocumentRoot &quot;/home/wwwroot/blog&quot;</div><div>    ServerName  blog.thinkmo.com</div><div>    &lt;Directory &quot;/home/wwwroot/blog&quot;&gt;</div><div>        AllowOverride None</div><div>        Require all granted</div><div>    &lt;/Directory&gt;</div><div>&lt;/VirtualHost&gt;</div></div><ul><li><div>访问控制，基于源ip，目的ip，访问的客户端（火狐，ie）</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vim /etc/httpd/conf/httpd.conf</div><div>---------------------------</div><div># AllowOverride None</div><div># Require all granted</div><div>SetEnvIf User-Agent &quot;Firefox&quot; ff=1</div><div>Order allow,deny     #谁在后面谁的优先级高</div><div>Allow from env=ff   #如果火狐就同意访问</div></div><ul><ul><li><div>非火狐</div></li></ul></ul><div><img src="第九课 httpd 2021-8-28 114617_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><ul><li><div>apache虚拟目录</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mkdir /usr/local/data</div><div>echo &quot;Alias Data&quot; &gt; /usr/local/data/index.html</div><div>vim /etc/httpd/conf/httpd.conf</div><div>------------------------------------</div><div>Alias /data/ &quot;/usr/local/data/&quot;</div><div>&lt;Directory &quot;/usr/local/data/&quot;&gt;</div><div>    Options Indexes FollowSymLinks</div><div>    AllowOverride all</div><div>    Require all granted</div><div>&lt;/Directory&gt;</div></div><div><img src="第九课 httpd 2021-8-28 114617_files/Image [7].png" type="image/png" data-filename="Image.png" width="515"/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></span>
</div></body></html> 